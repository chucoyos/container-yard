<div class="flex flex-col mx-auto md:w-2/3 px-4 md:px-8 mb-20">

  <h1 class="my-4">Movimientos</h1>

  <div class="border rounded p-4 bg-blue-50 my-8 shadow">
    <%= form_with :url => moves_path, method: :get do |f| %>
      <div class="lg:flex gap-2 my-4">
        <div class="input-group">
          <%= f.label :number, "Numero de contenedor" %>
          <%= f.text_field :number, class: "form-control" %>
        </div>

        <% if current_user.role.name != "cliente" %>
          <div class="inline">
            <div class="input-group">
              <%= f.label :user_id, "Cliente" %>
              <%= f.select :user_id,
                    options_from_collection_for_select(
                      User.joins(:role).where(roles: { name: 'cliente' }),
                      :id,
                      :full_name,
                    ), { prompt: "Selecciona" }, class: "form-control" %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="lg:flex gap-2 my-4 border px-2 py-2 rounded-md bg-slate-200">
        <div class="input-group">
          <%= f.label :move_type, "Movimiento" %>
          <%= f.select :move_type, options_for_select([["Entrada", "Entrada"], ["Salida", "Salida"], ["Reacomodo", "Reacomodo"]]), { prompt: "Selecciona" }, class: "form-control" %>
        </div>
        <div class="input-group">
          <%= f.label :move_created_at, "Fecha del movimiento" %>
          <%= f.date_field :move_created_at, class: "form-control" %>
        </div>
      </div>

      <div class="input-group inline">
        <%= f.submit "Buscar", class: "btn-primary" %>
      </div>
    <% end %>
  </div>

  <div id="moves" class="min-w-full">
    <% if @moves.empty? %>
      <p class="text-gray-600">No hay resultados para la búsqueda</p>
    <% end %>

    <div class="flex-flex-col lg:hidden">
      <% @moves.each do |move| %>
        <%= link_to move do %>
          <p class="field">
            <%= move.container.number %>
            <%= move.container.size %>ft.
            <% if move.move_type == "Entrada" %>
              Entrada: <%= move.created_at.in_time_zone("America/Mexico_City").strftime("%d/%b/%y") %>
            <% end %>
            <% if move.move_type == "Salida" %>
              Salida: <%= move.created_at.in_time_zone("America/Mexico_City").strftime("%d/%b/%y") %>
            <% end %>
            <% if move.move_type == "Reacomodo" %>
              Reacomodo: <%= move.created_at.in_time_zone("America/Mexico_City").strftime("%d/%b/%y") %>
            <% end %>
          </p>
        <% end %>
      <% end %>
    </div>

    <div class="hidden lg:flex lg:flex-col gap-2">
      <table class="table w-full">
          <thead class="bg-slate-200">
            <tr>
              <th class="px-2">Num.</th>
              <th class="px-2">Cliente</th>
              <th class="px-2">Entrada</th>
              <th class="px-2">Reacomodo</th>
              <th class="px-2">Salida</th>
              <th class="px-2">Accion</th>
            </tr>
          </thead>
          <tbody>
            <% @moves.each do |move| %>
              <tr class="bg-white">
                <td class="border px-2"><%= move.container.number %></td>
                <td class="border px-2"><%= move.container.user.full_name %></td>
                <td class="border px-2">
                  <% if move.move_type == "Entrada" %>
                    <%= move.created_at.in_time_zone("America/Mexico_City").strftime("%d/%m/%Y") %>
                  <% else %>
                    N/A
                  <% end %>
                </td>

                <td class="border px-2">
                  <% if move.move_type == "Reacomodo" %>
                    <%= move.created_at.in_time_zone("America/Mexico_City").strftime("%d/%m/%Y") %>
                  <% else %>
                    N/A
                  <% end %>
                </td>

                <td class="border px-2">
                  <% if move.move_type == "Salida" %>
                    <%= move.created_at.in_time_zone("America/Mexico_City").strftime("%d/%m/%Y") %>
                  <% else %>
                    N/A
                  <% end %>
                </td>
            
                <td class="border px-2">
                  <%= link_to "Ver", move, class: "underline text-blue-900" %> |
                  <%= link_to "Eliminar", move, data: { turbo_confirm: "¿Estás seguro?", turbo_method: :delete }, class: "underline text-blue-900" %>
                </td>

              </tr>
            <% end %>
          </tbody>
      </table>
    </div>
    
  </div>
</div>
